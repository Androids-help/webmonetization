<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Web Monetization Senders · Web Monetization</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A WM sender is responsible for making payments to WM receivers. It interfaces"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Web Monetization Senders · Web Monetization"/><meta property="og:type" content="website"/><meta property="og:url" content="https://webmonetization.org/"/><meta property="og:description" content="A WM sender is responsible for making payments to WM receivers. It interfaces"/><meta property="og:image" content="https://webmonetization.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/fav-webmonetization.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/wm-icon.svg" alt="Web Monetization"/><h2 class="headerTitleWithLogo">Web Monetization</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="https://adrianhopebailie.github.io/web-monetization/" target="_self">Specification</a></li><li class=""><a href="https://forum.interledger.org" target="_self">Forum</a></li><li class=""><a href="https://github.com/interledger/webmonetization.org" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Explainer</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/api">API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Explainer</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/explainer">Web Monetization</a></li><li class="navListItem"><a class="navItem" href="/docs/receiving">Receiving Payments</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/sending">Senders</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">More</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/specification">Specification</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Web Monetization Senders</h1></header><article><div><span><p>A WM sender is responsible for making payments to WM receivers. It interfaces
with a user's browser which sends it payment instructions including who to pay,
when and how much.</p>
<h2><a class="anchor" aria-hidden="true" id="payment-handler-api"></a><a href="#payment-handler-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Payment Handler API</h2>
<p>Our expectation is the WM Sender will manifest as a Payment Handler as follows.</p>
<h3><a class="anchor" aria-hidden="true" id="monetization-payment-method"></a><a href="#monetization-payment-method" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>monetization</code> Payment Method</h3>
<p>Payment Handlers that are able to act as WM Senders MUST register themselves
with the platform as supportive of the <code>monetization</code> payment method.</p>
<p>The <code>monetization</code> payment method identifier will be registered as a
<a href="https://www.w3.org/TR/payment-method-id/#standardized-payment-method-identifiers">Standardized Payment Method</a>
through the Web Payments WG at W3C.</p>
<h3><a class="anchor" aria-hidden="true" id="paymentrequestevent-event"></a><a href="#paymentrequestevent-event" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>PaymentRequestEvent</code> Event</h3>
<p>Whenever the browser decides to send a payment via the WM Sender it will emit a
<a href="https://www.w3.org/TR/payment-handler/#the-paymentrequestevent"><code>PaymentRequestEvent</code></a>
with only a single
<a href="https://www.w3.org/TR/payment-request/#paymentmethoddata-dictionary"><code>PaymentMethodData</code></a>
dictionary in the <code>PaymentRequestEvent.methodData</code> property.</p>
<p>This dictionary will have the value <code>monetization</code> in the <code>supportedMethods</code>
property and <code>data</code> will be an instance of a
<a href="#monetizationrequest-dictionary"><code>MonetizationRequest</code></a> containing the
destination address to send to and the condition and expiry values to use.</p>
<p>The Payment Handler will use this to send a single Interledger payment to the
provided address, using the provided condition, expiry and data, and for the
amount specified in <code>PaymentRequestEvent.total</code>.</p>
<p><code>PaymentRequestEvent.total</code> is an instance of
<a href="https://www.w3.org/TR/payment-request/#paymentcurrencyamount-dictionary">PaymentCurrencyAmount </a>
specifying both an amount and a currency.</p>
<p>If the Payment Handler is unable to send in the specified currency then it
should call <code>PaymentRequestEvent.respondWith()</code> and provide a rejected Promise
indicating that the payment failed.</p>
<blockquote>
<p><strong>ISSUE</strong>: Do we need to indicate WHY this payment failed? Maybe an error code?</p>
<p>See <a href="https://github.com/adrianhopebailie/web-monetization/issues/13">Issue #13</a></p>
</blockquote>
<p>When it has completed the payment it invokes <code>PaymentRequestEvent.respondWith()</code>
passing in a Promise that resolves to an instance of
<a href="#monetizationresponse-dictionary"><code>MonetizationResponse</code></a> containing the
fulfillment and data from the response.</p>
<blockquote>
<p><strong>ISSUE</strong>: The <code>PaymentRequestEvent</code> currently includes the origin of the
calling website. Should this be removed for Monetization to preserve the
user's privacy?</p>
<p>See <a href="https://github.com/adrianhopebailie/web-monetization/issues/10">Issue #10</a></p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="monetizationrequest-dictionary"></a><a href="#monetizationrequest-dictionary" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>MonetizationRequest</code> Dictionary</h3>
<p>The data in the MonetizationRequest that is emitted to the Payment Handler
contains the destination address for the payment and the condition, expiry and
data to use in the Interledger packet.</p>
<pre><code class="hljs css language-webidl">  <span class="hljs-keyword">dictionary </span>MonetizationRequest {
    required DOMString destination<span class="hljs-comment">;</span>
    required DOMString condition<span class="hljs-comment">;</span>
    required DOMString expiry<span class="hljs-comment">;</span>
    DOMString data<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
</code></pre>
<table>
<thead>
<tr><th>Field</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>destination</td><td>The ILP Address provided by the WM Receiver for this session.</td></tr>
<tr><td>condition</td><td>32 bytes, base64 encoded condition to use for the ILP packet.</td></tr>
<tr><td>expiry</td><td>Expiry to use for the ILP packet</td></tr>
<tr><td>data</td><td>base64 encoded additional data to send in the ILP packet.</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="monetizationresponse-dictionary"></a><a href="#monetizationresponse-dictionary" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>MonetizationResponse</code> Dictionary</h3>
<p>The data in the MonetizationResponse that is sent by the Payment Handler
contains the fulfillment from the successful payment and the data from the
fulfill packet.</p>
<pre><code class="hljs css language-webidl">  <span class="hljs-keyword">dictionary </span>MonetizationRequest {
    required DOMString fulfillment<span class="hljs-comment">;</span>
    DOMString data<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
</code></pre>
<table>
<thead>
<tr><th>Field</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>fulfillment</td><td>32 bytes, base64 encoded fulfillment from the ILP packet.</td></tr>
<tr><td>data</td><td>base64 encoded additional data from the ILP packet.</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="questions-about-authorization"></a><a href="#questions-about-authorization" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Questions about Authorization</h2>
<p>When the Payment Handler is invoked (handling a new <code>PaymentRequestEvent</code>) it is
expected to send a payment on behalf of the user.</p>
<p>If the Payment Handler is not currently authorized to send payments then it can
either invoke the <code>PaymentRequestEvent.openWindow()</code> to provide UI to the user
to login and authorize it OR it can reject the request (by passing a rejected
Promise to <code>PaymentRequestEvent.respondWith()</code>) and let the browser handle this
case.</p>
<p>The former is quite intrusive on the user experience unless this is throttled by
the browser in some way but the latter is likely to result in a lot of failures
that go undetected.</p>
<h2><a class="anchor" aria-hidden="true" id="supporting-payment-streams"></a><a href="#supporting-payment-streams" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Supporting Payment Streams</h2>
<p>As detailed in the <a href="/docs/explainer">explainer</a>, the user's browser will get a
unique receiver address and shared secret for each page refresh/navigation (a
monetization session).</p>
<p>This specification assumes the browser will then handle the generation of a new
condition (using the shared secret) for each payment that it wishes to send.</p>
<p>It should be noted that the browser will then emit multiple
<code>PaymentRequestEvent</code> events (one for each payment it sends) which is in
contrast to how this event is expected to be emitted when the a website creates
a PaymentRequest and the event is being emitted as a result of the website
calling <code>show()</code> and the user selecting a payment instrument.</p>
<p>In the latter case only a single event is emitted and the calling website waits
for the Promise returned by <code>show()</code> to resolve the value passed by the Payment
Handler to <code>respondWith()</code>.</p>
<p>While this proposal requires minimal changes to the Payment Handler API
specification it does imply some changes to the
<a href="https://www.w3.org/TR/payment-handler/#handling-a-payment-request">Handling a Payment Request</a>
and
<a href="https://www.w3.org/TR/payment-handler/#dfn-methoddata-population-algorithm">MethodData Population</a>
algorithms.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/receiving"><span class="arrow-prev">← </span><span>Receiving Payments</span></a><a class="docs-next button" href="/docs/specification"><span>Specification</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#payment-handler-api">Payment Handler API</a><ul class="toc-headings"><li><a href="#monetization-payment-method"><code>monetization</code> Payment Method</a></li><li><a href="#paymentrequestevent-event"><code>PaymentRequestEvent</code> Event</a></li><li><a href="#monetizationrequest-dictionary"><code>MonetizationRequest</code> Dictionary</a></li><li><a href="#monetizationresponse-dictionary"><code>MonetizationResponse</code> Dictionary</a></li></ul></li><li><a href="#questions-about-authorization">Questions about Authorization</a></li><li><a href="#supporting-payment-streams">Supporting Payment Streams</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>WebMonetization.org</h5></div><div><h5>Navigation</h5><a href="/">Home</a><a href="/meta-tag">Meta Tag Generator</a></div><div><h5>Community</h5><a href="https://github.com/interledger/webmonetization.org" target="_blank" rel="noreferrer noopener">GitHub</a><a href="https://forum.interledger.org" target="_blank" rel="noreferrer noopener">ILP Forum</a><a href="https://discourse.wicg.io/t/proposal-web-monetization-a-new-revenue-model-for-the-web/3785" target="_blank" rel="noreferrer noopener">Web Platform Incubator Community Group</a><a href="https://interledger.org" target="_blank" rel="noreferrer noopener">Interledger</a></div><div><h5>Resources</h5><a href="/docs/en/getting-started.html">Docs</a><a href="https://adrianhopebailie.github.io/web-monetization/" target="_blank" rel="noreferrer noopener">Specification</a><a href="https://paymentpointers.org" target="_blank" rel="noreferrer noopener">Payment Pointers</a></div></section><section class="copyright"></section></footer></div></body></html>